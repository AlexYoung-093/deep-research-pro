# Deep Research Pro 使用说明

## 一、系统概述

Deep Research Pro 是一个基于 AI 的深度研究报告生成系统，由两个核心部分组成：

1. **Dify 工作流后端**：负责多源信息抓取、AI 深度分析、报告生成和数据可视化
2. **Next.js 前端应用**：提供用户界面、实时进度展示和报告查看

---

## 二、安装部署

### 2.1 前置条件

- **Node.js**: 18.x 或更高版本
- **npm**: 9.x 或更高版本
- **Dify 平台**: 需要有可访问的 Dify 实例

### 2.2 安装步骤

#### 步骤 1: 进入项目目录

```powershell
cd E:\PersonalWeb\2026.01.05_DeepResearch_Pro\frontend
```

#### 步骤 2: 安装依赖

```powershell
npm install
```

等待安装完成，预计需要 2-5 分钟。

#### 步骤 3: 配置环境变量

1. 复制示例文件：
   ```powershell
   copy env.example .env.local
   ```

2. 用文本编辑器打开 `.env.local`，修改以下内容：
   ```
   DIFY_API_URL=你的Dify工作流API地址
   DIFY_API_KEY=你的API密钥
   ```

#### 步骤 4: 导入 Dify 工作流

1. 登录 Dify 平台（如 http://dify-dev.xtalpi.xyz）
2. 点击"创建应用" → 选择"从 DSL 导入"
3. 上传文件：`dify_workflow/deep_research_workflow_v2.yml`
4. 配置 LLM 模型（确保模型支持足够的 token 限制）
5. **配置环境变量**：
   - 进入工作流 → 点击右上角"环境变量"
   - 添加变量 `JINA_API_KEY`，填入你的 Jina Reader API Key
   - Jina API Key 获取地址：https://jina.ai/reader （免费注册）
6. 点击"发布"
7. 进入"API 访问"，复制 API 密钥填入 `.env.local`

#### 步骤 5: 启动应用

```powershell
npm run dev
```

启动成功后，访问 http://localhost:3000

---

## 三、功能使用

### 3.1 创建研究任务

1. **打开首页**：访问 http://localhost:3000

2. **填写研究参数**：

   | 字段 | 必填 | 说明 | 可选值 |
   |------|------|------|--------|
   | 研究主题 | ✅ | 你想研究的主题 | 自由输入（如：2024年新能源汽车市场） |
   | 报告类型 | ✅ | 报告的分析角度 | 行业研报 / 竞品分析 / 技术调研 / 市场分析 / 趋势预测 / 政策解读 |
   | 研究深度 | ✅ | 分析的深入程度 | 快速概览(5-10分钟) / 中度分析(15-20分钟) / 深度研究(30-45分钟) |
   | 报告字数 | ✅ | 期望的报告长度 | 1500字 / 3000字 / 5000字 / 8000字 |

3. **开始研究**：点击"开始深度研究"按钮

### 3.2 查看执行进度

点击开始后，右侧进度面板会显示：

- **状态指示**：当前正在执行的节点名称
- **进度条**：整体完成百分比
- **节点列表**：每个节点的执行状态和耗时
- **计时器**：总耗时统计

**节点执行顺序**：
1. 开始（初始化）
2. HTTP抓取-Bing/Google/DuckDuckGo（并行）
3. 研究规划
4. 信息整合与深度分析
5. 报告撰写
6. 数据结构化提取（新增）
7. 图表配置生成（新增）
8. HTML转换
9. 保存文件
10. 结束

### 3.3 查看研究报告

执行完成后，报告区域会自动显示，包含三个标签页：

#### 报告预览
- 渲染后的精美 HTML 页面
- 苹果官网风格设计
- 支持滚动浏览

#### 数据图表
- 自动生成的可视化图表
- 支持柱状图、折线图、饼图、雷达图
- 每个图表支持：刷新、下载为图片、全屏查看

#### 源代码
- 原始 HTML 代码
- 可复制用于其他用途

### 3.4 导出报告

提供多种导出方式：

| 按钮 | 功能 |
|------|------|
| 复制 HTML | 将完整 HTML 复制到剪贴板 |
| 新窗口打开 | 在新标签页全屏查看 |
| 下载图表 | 下载图表配置 JSON 文件 |
| 下载报告 | 下载完整 HTML 文件 |

---

## 四、图表功能

### 4.1 图表类型

| 类型 | 适用场景 | 示例 |
|------|----------|------|
| 柱状图 | 数值对比 | 各品牌市场份额对比 |
| 折线图 | 趋势展示 | 年度销量变化趋势 |
| 饼图 | 占比分布 | 市场份额分布 |
| 雷达图 | 多维评估 | 产品能力雷达图 |
| 表格 | 详细数据 | 关键指标汇总 |

### 4.2 图表交互

每个图表支持以下操作：

- **鼠标悬停**：显示数据详情提示框
- **图例点击**：隐藏/显示对应数据系列
- **刷新按钮**：重新调整图表尺寸
- **下载按钮**：保存为 PNG 图片
- **全屏按钮**：全屏查看图表

### 4.3 自定义图表

如需调整图表样式，可修改配置文件：

```
frontend/components/charts/ChartRenderer.tsx
```

主要可配置项：
- `APPLE_THEME`：颜色、字体等主题配置
- `enhanceChartOption`：图表增强逻辑

---

## 五、常见问题

### Q1: 安装依赖时报错

**可能原因**：Node.js 版本过低

**解决方案**：
```powershell
node -v  # 检查版本，需要 18.x 以上
```
如版本过低，请从 https://nodejs.org 下载新版本。

### Q2: 启动时提示端口被占用

**解决方案**：修改端口号
```powershell
# 使用其他端口启动
$env:PORT=3001; npm run dev
```

### Q3: API 连接失败

**可能原因**：
1. API URL 配置错误
2. API Key 无效
3. 网络无法访问 Dify 服务

**解决方案**：
1. 检查 `.env.local` 中的配置
2. 确认 Dify 工作流已发布
3. 确认网络可以访问 Dify 服务地址

### Q4: 报告生成时间过长

**影响因素**：
- 研究深度越高，耗时越长
- 外部搜索引擎响应时间
- LLM 模型推理速度

**建议**：
- 测试时使用"快速概览"模式
- 确保网络稳定

### Q5: 图表没有生成

**可能原因**：
- 报告内容中没有可量化的数据
- LLM 生成的 JSON 格式错误

**解决方案**：
1. 查看浏览器控制台日志
2. 检查 Dify 工作流日志中"数据结构化提取"节点输出

### Q6: 页面样式异常

**解决方案**：
```powershell
# 清除缓存并重新构建
Remove-Item -Recurse -Force .next
npm run dev
```

---

## 六、技术架构

```
┌─────────────────────────────────────────────────────────────┐
│                      用户浏览器                              │
│   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │
│   │ 研究表单    │  │ 进度展示    │  │ 报告查看    │        │
│   └─────────────┘  └─────────────┘  └─────────────┘        │
└───────────────────────────┬─────────────────────────────────┘
                            │ HTTP/SSE
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                  Next.js 前端 (端口 3000)                    │
│   ┌─────────────────────────────────────────────────────┐   │
│   │              API Routes (/api/research/stream)       │   │
│   │                    ↓ SSE 流式代理                    │   │
│   └─────────────────────────────────────────────────────┘   │
└───────────────────────────┬─────────────────────────────────┘
                            │ HTTP/SSE
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                    Dify 工作流平台                           │
│   ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐   │
│   │HTTP抓取│→│研究规划│→│深度分析│→│报告撰写│→│数据可视│   │
│   └────────┘ └────────┘ └────────┘ └────────┘ └────────┘   │
│                                                             │
│                    ↓ 调用 LLM API                           │
│   ┌─────────────────────────────────────────────────────┐   │
│   │           大语言模型 (Claude/GPT/自定义)              │   │
│   └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

---

## 七、文件说明

| 文件/目录 | 说明 |
|-----------|------|
| `frontend/` | Next.js 前端应用 |
| `frontend/app/` | Next.js App Router 页面 |
| `frontend/components/` | React 组件 |
| `frontend/lib/` | 工具函数和状态管理 |
| `dify_workflow/` | Dify 工作流定义文件 |
| `.claude/` | Claude Skills 配置 |
| `env.example` | 环境变量示例 |

---

## 八、更新日志

### v2.0.0 (2026-01-06)
- ✨ 新增数据可视化功能
- ✨ 新增 ECharts 图表渲染
- ✨ 新增数据结构化提取节点
- ✨ 新增图表配置生成节点
- 🎨 优化苹果风格设计

### v1.0.0 (2026-01-05)
- 🎉 初始版本发布
- ✅ 基础研究报告生成
- ✅ 实时进度展示
- ✅ HTML 报告预览与下载

---

## 九、联系支持

如有问题，请检查：
1. 本使用说明的"常见问题"部分
2. 浏览器控制台错误日志
3. Dify 平台工作流执行日志

---

**文档版本**: 2.0.0  
**最后更新**: 2026-01-06

